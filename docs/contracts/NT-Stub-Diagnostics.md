# Contract: NT-EXP, NT-DPP, NT-HCE, NT-PAT (기타 스터브 및 진단 엔진)

본 문서는 보조 엔진/스터브 모듈이 준수해야 하는 공통 Contract입니다. 모든 스터브 모듈은 단순 빈 파일이 아니라 "표준 인터페이스와 diagnostics" 기능을 반드시 제공해야 합니다. 

---

## 1. NT-EXP (Experiment)
- **성격**: 실험용 슬롯 스터브.
- **Contract**: 향후 확장 포인트를 위한 플래그십 엔진. 기본은 아무런 변형을 가하지 않는 균등 스코어맵 반환(no-op).
- **출력**: `topk=[]`, `scores=0.5` 일괄, `diagnostics` 내에 차후 확장이 필요함을 TODO 코멘트로 삽입하여 리포트에 표시.

---

## 2. NT-DPP (Diversity Penalty)
- **성격**: 다양성 페널티 계산 라이브러리.
- **Contract**: 전역 포트폴리오 결합 단계에서 활용할 페널티 산출 함수를 제공합니다. 
- **입력**: 임의의 조합/집합 (Set / List of candidates).
- **알고리즘**: 
  - **Overlap Penalty**: 특정 번호가 한 포트폴리오 내에서 너무 빈번하게 나오는 경우($p_{max}$ 0.14~0.18 등) 페널티 부여. Pairwise overlap $\le 2$ (자카드 계수 $\le 0.3$) 위반 빈도별 차감.
- **출력**: 포트폴리오/조합 단위의 `penalty_score`. 이번 단계에서는 오너의 명시적 지시가 없으므로 실제 조합 기반 동작 대신 **유틸리티 기능(API)으로만 구현**. 빈 엔진 런에서는 `topk=[]` 및 `scores` 변동 없음을 기본으로 함.

---

## 3. NT-HCE (Ending Patterns)
- **성격**: 끝수 분포 및 조합 패턴 점수화 엔진.
- **Contract**: 끝수(0~9)의 로컬/글로벌 분포 편차 계산 모듈.
- **알고리즘**: 
  - 특정 구간 내에서 과밀/과소 출현하는 끝수를 진단. 
  - 특정 동일 끝수가 과밀(예: >2회) 출현한 사실은 점수화하지 않고 오직 "경고용 진단(리포트)"로만 송출.
- **출력**: `diagnostics` 항목에 경고 문자열 및 빈도 테이블.

---

## 4. NT-PAT (Pattern Analysis)
- **성격**: 패턴 기반 빈도/상승률 분석 엔진.
- **Contract**: 번호간 Pair/Triple, Gap, 추첨순서 전이 등의 "패턴 키"를 추출.
- **출력**: 각 패턴별 빈도, 상승률을 기반하여 가장 기여가 높은 상위 패턴 TopK 딕셔너리 산출. 숫자가 아닌 "패턴 키 추출의 근거 매핑(evidence)"을 증빙 자료로 리포트에 삽입.

---
## 공통 제약사항
- 모든 모듈은 인터페이스 호환을 위해 Base Engine 패러다임을 따르되, 오케스트레이터 단에서 K_eval=20 메트릭스 채택을 할 때 스코어 계산에 의도치 않은 패널티나 기형 데이터(NaN)를 리턴하지 않도록 방어 코드(Robust)를 포함합니다.
